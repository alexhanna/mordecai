<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Mordecai by caerusassociates</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Mordecai</h1>
        <p>Full text geocoding software.</p>

        <p class="view"><a href="https://github.com/caerusassociates/mordecai">View the Project on GitHub <small>caerusassociates/mordecai</small></a></p>


        <ul>
          <li><a href="https://github.com/caerusassociates/mordecai/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/caerusassociates/mordecai/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/caerusassociates/mordecai">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><img src="http://caerusassociates.com/wp-content/uploads/2012/03/Caerus_logo.png" alt="http://caerusassociates.com/wp-content/uploads/2012/03/Caerus_logo.png"></p>

<p>Mordecai is a new, automated document geocoding system built by Caerus Associates. Mordecai has global coverage that seeks to improve on existing geocoding approaches in three ways: improved accuracy, ability to limit searches to a defined country or region, and ease of switching out named entity recognition services. Mordecai runs as a web service, exposing two endpoints: <code>/country</code>, for determining the country focus of a piece of text, and <code>/places</code>, for returning latitude and longitude for each individual place mentioned in the text.</p>

<p>At its most basic, automated geocoding of text is made up of three steps:</p>

<ol>
<li>recognizing and extracting place words in text</li>
<li>resolving ambiguous place names to the best available place name </li>
<li>finding the latitude and longitude for the correctly resolved place</li>
</ol>

<p>Mordecai does all three steps, accepting text as input and returning a list of place names and latitude/longitudes as output.</p>

<h2>
<a id="step-1-mitie-named-entity-recognition" class="anchor" href="#step-1-mitie-named-entity-recognition" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1: MITIE Named Entity Recognition</h2>

<p>The first step in any geocoding pipeline is to extract place name words from text. For this task, Mordecai uses MIT Lincoln Labs’s MITIE, a fast and accurate XDATA-funded named entity recognition (NER) system. MITIE comes with a model trained on a large corpus of news text. Mordecai uses the pre-trained model, though training a custom model for non-standard text is straightforward and something we have done in other applications. Our MITIE wrapper returns a list of labeled entities (people, locations, organizations, and miscellaneous) and a bag of "context" words occurring on either side of each extracted entity.</p>

<h2>
<a id="step-2-establishing-the-country-with-the-country-endpoint" class="anchor" href="#step-2-establishing-the-country-with-the-country-endpoint" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2: Establishing the country with the <code>/country</code> endpoint</h2>

<p>Taken in isolation, a place name like "Prague" could be resolved to several places. Searching a place name gazetteer like Geonames.org, which Mordecai uses, finds both the obvious (Prague, Czech Republic) and the obscure (Prague, Oklahoma). A naïve approach might take all of the place names mentioned in the text, find all the countries that have a location with that name, and sum the "votes" for each country. However, that approach is enormously skewed toward large, connected, English speaking countries, resulting in the bias toward the United States observed in other geocoding systems.</p>

<p>Instead, Mordecai uses a sophisticated neural network model called <code>word2vec</code> that represents words as vectors in high-dimensional space. These vectors are the output of an unsupervised learning model that takes large amounts of text as inputs and learns a model that represents a remarkably large degree of the word’s semantic meaning in the vector. Mordecai converts each location name into a word2vec vector, which is compared to the word2vec vector for each country name in the world. The country with the closest similarity to the locations from a document is treated as the subject country of the document. In the case of Prague, it finds that it is much closer to the vector representation of "Czech_Republic" than the "Oklahoma" vector, similar to human intuition:</p>

<pre><code>trained_model.similarity("Prague", "Oklahoma")
0.171944306651
trained_model.similarity("Prague", "Czech_Republic")
0.602116649669
</code></pre>

<p>This "one best country" result can be used on its own for selecting documents pertaining to a country, or as an input to the third step of the process.</p>

<h2>
<a id="step-3-resolving-each-place-name-with-the-places-endpoint" class="anchor" href="#step-3-resolving-each-place-name-with-the-places-endpoint" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3: Resolving each place name with the <code>/places</code> endpoint</h2>

<p>The final step in the Mordecai pipeline is to take a list of places names, their context words, and a country filter and perform an optimized search for each place name in a global gazetteer of place names. Mordecai holds the Geonames gazetteer in Elasticsearch, a search server that allows for very fast full text search and highly customized queries. The “context” words that occur on either side of the place name allow us to narrow our search to only specific kinds of Geonames records in cases where the context words include terms like "city of" or "Governorate." The context words and <code>word2vec</code> results allow us to dramatically cut down on the search results and help us pick place names without resorting to brittle hard-coded rules or lots of conditional logic or regex.</p>

<h2>
<a id="example-usage" class="anchor" href="#example-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example Usage</h2>

<pre><code>curl -XPOST -H "Content-Type: application/json" 
--data '{"text":"The death toll from the April 25 quake in the 
Himalayan mountain nation has reached 7,675, with more than 16,300 
people injured, the government said. As rescuers hunted for more 
than 180 bodies in the village of Langtang, 60 km (37 miles) north of 
the capital Kathmandu, seven bodies including of that of a German trekker
 were recovered at Manaslu, another climbing site."}' 'localhost:5000/places'
</code></pre>

<p>Returns:</p>

<pre><code>[{"lat": 28.21717, "searchterm": "Langtang", "lon": 85.52262, 
"countrycode": "NPL", "placename": "Langtang"}, {"lat": 27.70169, 
"searchterm": "Kathmandu", "lon": 85.3206, "countrycode": "NPL", 
"placename": "Kathmandu"}, {"lat": 27.71925, "searchterm": "Manaslu", 
"lon": 85.3211, "countrycode": "NPL", "placename": "Manaslu"}]
</code></pre>

<h2>
<a id="technical-details" class="anchor" href="#technical-details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Technical Details</h2>

<p>MITIE is written in C/C++ and is called through a Python wrapper. The <code>/country</code> and <code>/places</code> endpoints are both web services, written in Python and served using Flask. The Geonames gazetteer is stored in Elasticsearch, which runs in a Docker container. Both Elasticsearch and Mordecai itself perform caching to speed repetitive queries. For more information:</p>

<ul>
<li>MITIE: <a href="https://github.com/mit-nlp/MITIE">https://github.com/mit-nlp/MITIE</a>
</li>
<li>Flask-RESTful: <a href="https://flask-restful.readthedocs.org/en/0.3.3/">https://flask-restful.readthedocs.org/en/0.3.3/</a> </li>
<li>Geonames: <a href="http://www.geonames.org/">http://www.geonames.org/</a>
</li>
<li>word2vec: <a href="https://code.google.com/p/word2vec/">https://code.google.com/p/word2vec/</a>
</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/caerusassociates">caerusassociates</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
